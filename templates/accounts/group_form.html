{% extends "base.html" %}

{% block title %}{% if is_edit %}Edit Role{% else %}Create Role{% endif %}{% endblock %}

{% block breadcrumb %}
<li class="breadcrumb-item"><a href="{% url 'accounts:group_list' %}">Roles</a></li>
<li class="breadcrumb-item active" aria-current="page">{% if is_edit %}Edit Role{% else %}Create Role{% endif %}</li>
{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="page-header mb-4">
  <h1 class="page-title">
    <i class="bi bi-{% if is_edit %}pencil-square{% else %}shield-plus{% endif %} me-2"></i>
    {% if is_edit %}Edit Role{% else %}Create New Role{% endif %}
  </h1>
</div>

<!-- Role Form Card -->
<div class="card">
  <div class="card-header">
    <h4 class="mb-0">Role Details</h4>
  </div>
  <div class="card-body">
    <form method="post">
      {% csrf_token %}
      <div class="mb-4">
        <label for="id_name" class="form-label fw-medium">Role Name <span class="text-danger">*</span></label>
        <input type="text" name="name" class="form-control" id="id_name" value="{% if is_edit %}{{ group.name }}{% endif %}" required placeholder="e.g., System Admin, Data Manager">
      </div>

      <div class="mb-4">
        <label class="form-label fw-medium">Permissions</label>
        <div class="form-control" style="max-height: 400px; overflow-y: auto; padding: 1rem;">
          {% for perm in permissions %}
          <div class="form-check mb-2">
            <input class="form-check-input" type="checkbox" name="permissions" value="{{ perm.id }}" id="perm{{ perm.id }}"
              {% if is_edit %}{% if perm.id in group_perm_ids %}checked{% endif %}{% endif %}>
            <label class="form-check-label" for="perm{{ perm.id }}">
              <span class="badge bg-secondary me-1">{{ perm.content_type.app_label }}</span>
              {{ perm.name|default:perm.codename }}
            </label>
          </div>
          {% endfor %}
        </div>
        <div class="form-text">Select the permissions this role should have</div>
      </div>

      <div class="d-flex justify-content-end gap-2">
        <a href="{% url 'accounts:group_list' %}" class="btn btn-outline-secondary">
          <i class="bi bi-x-circle me-1"></i>Cancel
        </a>
        <button type="submit" class="btn btn-primary">
          <i class="bi bi-check-circle me-1"></i>{% if is_edit %}Save Changes{% else %}Create Role{% endif %}
        </button>
      </div>
    </form>
  </div>
</div>
{% endblock %}
